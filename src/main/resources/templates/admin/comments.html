<!DOCTYPE html>
<html lang="bg" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ö–æ–º–µ–Ω—Ç–∞—Ä–∏ - UFC –ë—ä–ª–≥–∞—Ä–∏—è</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a th:href="@{/}" class="logo">
                    <div class="logo-icon">UFC</div>
                    <h1>UFC –ë—ä–ª–≥–∞—Ä–∏—è - –ê–¥–º–∏–Ω</h1>
                </a>
                <div class="auth-buttons">
                    <div sec:authorize="isAuthenticated()" class="user-info">
                        <span class="user-welcome">–ó–¥—Ä–∞–≤–µ–π, <strong sec:authentication="name">Admin</strong>!</span>
                        <a th:href="@{/}" class="btn btn-secondary">üè† –ù–∞—á–∞–ª–æ</a>
                        <form th:action="@{/logout}" method="post" style="display: inline;">
                            <button type="submit" class="btn btn-danger">–ò–∑—Ö–æ–¥</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <nav>
        <div class="container">
            <div class="nav-content">
                <ul class="nav-links">
                    <li><a th:href="@{/admin/dashboard}">üìä –¢–∞–±–ª–æ</a></li>
                    <li><a th:href="@{/admin/users}">üë• –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</a></li>
                    <li><a th:href="@{/admin/topics}">üìù –¢–µ–º–∏</a></li>
                    <li><a th:href="@{/admin/comments}" class="active">üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä–∏</a></li>
                    <li><a th:href="@{/admin/analytics}">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container">
        <!-- Success/Error Messages -->
        <div th:if="${successMessage}" class="alert alert-success" role="alert">
            ‚úÖ <span th:text="${successMessage}">Success!</span>
        </div>
        <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
            ‚ùå <span th:text="${errorMessage}">Error!</span>
        </div>

        <div class="admin-page">
            <h2>üí¨ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –ö–æ–º–µ–Ω—Ç–∞—Ä–∏</h2>

            <!-- Search -->
            <div class="admin-filters">
                <form th:action="@{/admin/comments}" method="get">
                    <div class="form-group">
                        <label for="search">–¢—ä—Ä—Å–µ–Ω–µ:</label>
                        <input type="text" id="search" name="search" th:value="${search}"
                               placeholder="–¢—ä—Ä—Å–∏ –≤ —Å—ä–¥—ä—Ä–∂–∞–Ω–∏–µ—Ç–æ..." class="admin-search-input">
                    </div>
                    <button type="submit" class="btn btn-primary">üîç –¢—ä—Ä—Å–∏</button>
                    <a th:href="@{/admin/comments}" class="btn btn-secondary">üîÑ –ò–∑—á–∏—Å—Ç–∏</a>
                </form>
            </div>

            <!-- Quick Stats -->
            <div class="admin-stats-grid" style="grid-template-columns: repeat(3, 1fr); margin-bottom: 2rem;">
                <div class="admin-stat-card">
                    <div class="stat-icon">üí¨</div>
                    <div class="stat-info">
                        <div class="stat-value" th:text="${comments.size()}">0</div>
                        <div class="stat-label">–û–±—â–æ –ö–æ–º–µ–Ω—Ç–∞—Ä–∏</div>
                    </div>
                </div>
                <div class="admin-stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-info">
                        <div class="stat-value" th:text="${uniqueAuthors}">0</div>
                        <div class="stat-label">–£–Ω–∏–∫–∞–ª–Ω–∏ –ê–≤—Ç–æ—Ä–∏</div>
                    </div>
                </div>
                <div class="admin-stat-card">
                    <div class="stat-icon">üìù</div>
                    <div class="stat-info">
                        <div class="stat-value" th:text="${uniquePosts}">0</div>
                        <div class="stat-label">–†–∞–∑–ª–∏—á–Ω–∏ –ü–æ—Å—Ç–æ–≤–µ</div>
                    </div>
                </div>
            </div>

            <!-- Comments Table -->
            <div class="admin-table-container">
                <div th:if="${comments.isEmpty()}" class="empty-state">
                    <p>–ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏</p>
                </div>

                <table th:if="${!comments.isEmpty()}" class="admin-table">
                    <thead>
                        <tr>
                            <th style="width: 50px;">ID</th>
                            <th style="width: 40%;">–°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ</th>
                            <th style="width: 120px;">–ê–≤—Ç–æ—Ä</th>
                            <th style="width: 150px;">–ü–æ—Å—Ç</th>
                            <th style="width: 150px;">–î–∞—Ç–∞</th>
                            <th style="width: 100px;">–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="comment : ${comments}">
                            <td th:text="${comment.id}">1</td>
                            <td>
                                <div style="max-width: 400px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                    <span th:text="${#strings.length(comment.content) > 100 ? #strings.substring(comment.content, 0, 100) + '...' : comment.content}">
                                        Comment content
                                    </span>
                                </div>
                            </td>
                            <td>
                                <a th:href="@{/user/profile/{username}(username=${comment.author.username})}"
                                   th:text="${comment.author.username}"
                                   target="_blank"
                                   style="color: #ffd700; text-decoration: none;">
                                    Author
                                </a>
                            </td>
                            <td>
                                <a th:href="@{/forum/topic/{topicId}(topicId=${comment.post.topic.id})}"
                                   target="_blank"
                                   style="color: #ffd700; text-decoration: none;">
                                    <span th:text="${#strings.length(comment.post.topic.title) > 30 ? #strings.substring(comment.post.topic.title, 0, 30) + '...' : comment.post.topic.title}">
                                        Post title
                                    </span>
                                </a>
                            </td>
                            <td th:text="${#temporals.format(comment.createdAt, 'dd.MM.yyyy HH:mm')}">Date</td>
                            <td>
                                <div class="admin-actions">
                                    <!-- View Post -->
                                    <a th:href="@{/forum/topic/{topicId}(topicId=${comment.post.topic.id})}"
                                       class="btn btn-sm btn-info"
                                       title="–í–∏–∂ –ø–æ—Å—Ç"
                                       target="_blank">
                                        üëÅÔ∏è
                                    </a>

                                    <!-- Delete -->
                                    <form th:action="@{/admin/comments/{id}/delete(id=${comment.id})}"
                                          method="post"
                                          style="display: inline;"
                                          onsubmit="return confirm('–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ —Ç–æ–∑–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä?');">
                                        <button type="submit" class="btn btn-sm btn-danger" title="–ò–∑—Ç—Ä–∏–π">
                                            üóëÔ∏è
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Info Box -->
            <div class="info-box" style="margin-top: 2rem;">
                <h3>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
                <ul>
                    <li>–ö–æ–º–µ–Ω—Ç–∞—Ä–∏—Ç–µ —Å–µ –ø–æ–∫–∞–∑–≤–∞—Ç –≤ –æ–±—Ä–∞—Ç–µ–Ω —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ–Ω —Ä–µ–¥ (–Ω–∞–π-–Ω–æ–≤–∏ –ø—ä—Ä–≤–∏)</li>
                    <li>–ü—Ä–∏ –∏–∑—Ç—Ä–∏–≤–∞–Ω–µ –Ω–∞ –∫–æ–º–µ–Ω—Ç–∞—Ä, —Ç–æ–π —Å–µ –ø—Ä–µ–º–∞—Ö–≤–∞ –æ–∫–æ–Ω—á–∞—Ç–µ–ª–Ω–æ</li>
                    <li>–ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ —Ç—ä—Ä—Å–µ–Ω–µ—Ç–æ, –∑–∞ –¥–∞ –Ω–∞–º–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏</li>
                    <li>–ö–ª–∏–∫–Ω–µ—Ç–µ –Ω–∞ –∞–≤—Ç–æ—Ä–∞, –∑–∞ –¥–∞ –≤–∏–¥–∏—Ç–µ –Ω–µ–≥–æ–≤–∏—è –ø—Ä–æ—Ñ–∏–ª</li>
                    <li>–ö–ª–∏–∫–Ω–µ—Ç–µ –Ω–∞ –∑–∞–≥–ª–∞–≤–∏–µ—Ç–æ –Ω–∞ –ø–æ—Å—Ç–∞, –∑–∞ –¥–∞ –≤–∏–¥–∏—Ç–µ —Ü–µ–ª–∏—è –ø–æ—Å—Ç</li>
                </ul>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2024 UFC –ë—ä–ª–≥–∞—Ä–∏—è –§–æ—Ä—É–º - –ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª</p>
            </div>
        </div>
    </footer>
</body>
</html>
