<!DOCTYPE html>
<html lang="bg" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –¢–µ–º–∏ - UFC –ë—ä–ª–≥–∞—Ä–∏—è</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a th:href="@{/}" class="logo">
                    <div class="logo-icon">UFC</div>
                    <h1>UFC –ë—ä–ª–≥–∞—Ä–∏—è - –ê–¥–º–∏–Ω</h1>
                </a>
                <div class="auth-buttons">
                    <div sec:authorize="isAuthenticated()" class="user-info">
                        <span class="user-welcome">–ó–¥—Ä–∞–≤–µ–π, <strong sec:authentication="name">Admin</strong>!</span>
                        <a th:href="@{/}" class="btn btn-secondary">üè† –ù–∞—á–∞–ª–æ</a>
                        <form th:action="@{/logout}" method="post" style="display: inline;">
                            <button type="submit" class="btn btn-danger">–ò–∑—Ö–æ–¥</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <nav>
        <div class="container">
            <div class="nav-content">
                <ul class="nav-links">
                    <li><a th:href="@{/admin/dashboard}">üìä –¢–∞–±–ª–æ</a></li>
                    <li><a th:href="@{/admin/users}">üë• –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</a></li>
                    <li><a th:href="@{/admin/topics}" class="active">üìù –¢–µ–º–∏</a></li>
                    <li><a th:href="@{/admin/comments}">üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä–∏</a></li>
                    <li><a th:href="@{/admin/analytics}">üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container">
        <!-- Success/Error Messages -->
        <div th:if="${successMessage}" class="alert alert-success" role="alert">
            ‚úÖ <span th:text="${successMessage}">Success!</span>
        </div>
        <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
            ‚ùå <span th:text="${errorMessage}">Error!</span>
        </div>

        <div class="admin-page">
            <h2>üìù –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –¢–µ–º–∏</h2>

            <!-- Search and Filters -->
            <div class="admin-filters">
                <form th:action="@{/admin/topics}" method="get">
                    <div class="form-group">
                        <label for="search">–¢—ä—Ä—Å–µ–Ω–µ:</label>
                        <input type="text" id="search" name="search" th:value="${search}"
                               placeholder="–¢—ä—Ä—Å–∏ –ø–æ –∑–∞–≥–ª–∞–≤–∏–µ..." class="admin-search-input">
                    </div>
                    <div class="form-group">
                        <label for="category">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
                        <select id="category" name="category" class="admin-search-input">
                            <option value="">–í—Å–∏—á–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                            <option th:each="cat : ${categories}"
                                    th:value="${cat}"
                                    th:text="${cat.displayName}"
                                    th:selected="${category == cat.name()}">
                                Category
                            </option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary">üîç –¢—ä—Ä—Å–∏</button>
                    <a th:href="@{/admin/topics}" class="btn btn-secondary">üîÑ –ò–∑—á–∏—Å—Ç–∏</a>
                </form>
            </div>

            <!-- Quick Stats -->
            <div class="admin-stats-grid" style="grid-template-columns: repeat(4, 1fr); margin-bottom: 2rem;">
                <div class="admin-stat-card">
                    <div class="stat-icon">üìù</div>
                    <div class="stat-info">
                        <div class="stat-value" th:text="${totalElements}">0</div>
                        <div class="stat-label">–û–±—â–æ –¢–µ–º–∏</div>
                    </div>
                </div>
                <div class="admin-stat-card">
                    <div class="stat-icon">üìå</div>
                    <div class="stat-info">
                        <div class="stat-value" th:text="${pinnedCount ?: 0}">0</div>
                        <div class="stat-label">–ó–∞–∫–∞—á–µ–Ω–∏</div>
                    </div>
                </div>
                <div class="admin-stat-card">
                    <div class="stat-icon">üîí</div>
                    <div class="stat-info">
                        <div class="stat-value" th:text="${lockedCount ?: 0}">0</div>
                        <div class="stat-label">–ó–∞–∫–ª—é—á–µ–Ω–∏</div>
                    </div>
                </div>
                <div class="admin-stat-card">
                    <div class="stat-icon">üëÅÔ∏è</div>
                    <div class="stat-info">
                        <div class="stat-value" th:text="${totalViews ?: 0}">0</div>
                        <div class="stat-label">–û–±—â–æ –ü—Ä–µ–≥–ª–µ–¥–∏</div>
                    </div>
                </div>
            </div>

            <!-- Topics Table -->
            <div class="admin-table-container">
                <div th:if="${topics.isEmpty()}" class="empty-state">
                    <p>–ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ —Ç–µ–º–∏</p>
                </div>

                <table th:if="${!topics.isEmpty()}" class="admin-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>–ó–∞–≥–ª–∞–≤–∏–µ</th>
                            <th>–ê–≤—Ç–æ—Ä</th>
                            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                            <th>–ü—Ä–µ–≥–ª–µ–¥–∏</th>
                            <th>–û—Ç–≥–æ–≤–æ—Ä–∏</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–î–∞—Ç–∞</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="topic : ${topics}">
                            <td th:text="${topic.id}">1</td>
                            <td>
                                <a th:href="@{/forum/topic/{id}(id=${topic.id})}"
                                   th:text="${topic.title}"
                                   target="_blank"
                                   style="color: #ffd700; text-decoration: none;">
                                    Topic Title
                                </a>
                            </td>
                            <td>
                                <a th:href="@{/user/profile/{username}(username=${topic.author.username})}"
                                   th:text="${topic.author.username}"
                                   target="_blank"
                                   style="color: #ffd700; text-decoration: none;">
                                    Author
                                </a>
                            </td>
                            <td>
                                <span class="badge badge-info" th:text="${topic.category.displayName}">Category</span>
                            </td>
                            <td th:text="${topic.viewCount}">0</td>
                            <td th:text="${topic.replyCount}">0</td>
                            <td>
                                <span th:if="${topic.isPinned}" class="badge badge-warning">üìå –ó–∞–∫–∞—á–µ–Ω–∞</span>
                                <span th:if="${topic.isLocked}" class="badge badge-danger">üîí –ó–∞–∫–ª—é—á–µ–Ω–∞</span>
                                <span th:if="${!topic.isPinned && !topic.isLocked}" class="badge badge-success">‚úÖ –ê–∫—Ç–∏–≤–Ω–∞</span>
                            </td>
                            <td th:text="${#temporals.format(topic.createdAt, 'dd.MM.yyyy HH:mm')}">Date</td>
                            <td>
                                <div class="admin-actions">
                                    <!-- Pin/Unpin -->
                                    <form th:if="${!topic.isPinned}"
                                          th:action="@{/admin/topics/{id}/pin(id=${topic.id})}"
                                          method="post"
                                          style="display: inline;">
                                        <button type="submit" class="btn btn-sm btn-warning" title="–ó–∞–∫–∞—á–∏">
                                            üìå
                                        </button>
                                    </form>
                                    <form th:if="${topic.isPinned}"
                                          th:action="@{/admin/topics/{id}/unpin(id=${topic.id})}"
                                          method="post"
                                          style="display: inline;">
                                        <button type="submit" class="btn btn-sm btn-secondary" title="–û—Ç–∫–∞—á–∏">
                                            üìå
                                        </button>
                                    </form>

                                    <!-- Lock/Unlock -->
                                    <form th:if="${!topic.isLocked}"
                                          th:action="@{/admin/topics/{id}/lock(id=${topic.id})}"
                                          method="post"
                                          style="display: inline;">
                                        <button type="submit" class="btn btn-sm btn-warning" title="–ó–∞–∫–ª—é—á–∏">
                                            üîí
                                        </button>
                                    </form>
                                    <form th:if="${topic.isLocked}"
                                          th:action="@{/admin/topics/{id}/unlock(id=${topic.id})}"
                                          method="post"
                                          style="display: inline;">
                                        <button type="submit" class="btn btn-sm btn-success" title="–û—Ç–∫–ª—é—á–∏">
                                            üîì
                                        </button>
                                    </form>

                                    <!-- Delete -->
                                    <form th:action="@{/admin/topics/{id}/delete(id=${topic.id})}"
                                          method="post"
                                          style="display: inline;"
                                          onsubmit="return confirm('–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ —Ç–∞–∑–∏ —Ç–µ–º–∞?');">
                                        <button type="submit" class="btn btn-sm btn-danger" title="–ò–∑—Ç—Ä–∏–π">
                                            üóëÔ∏è
                                        </button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div th:if="${totalPages > 1}" class="pagination">
                <a th:if="${hasPrevious}"
                   th:href="@{/admin/topics(page=${currentPage - 1}, search=${search}, category=${category})}"
                   class="pagination-btn">
                    ‚Üê –ü—Ä–µ–¥–∏—à–Ω–∞
                </a>

                <span class="pagination-info">
                    –°—Ç—Ä–∞–Ω–∏—Ü–∞ <strong th:text="${currentPage + 1}">1</strong> –æ—Ç
                    <strong th:text="${totalPages}">1</strong>
                    (<strong th:text="${totalElements}">0</strong> –æ–±—â–æ —Ç–µ–º–∏)
                </span>

                <a th:if="${hasNext}"
                   th:href="@{/admin/topics(page=${currentPage + 1}, search=${search}, category=${category})}"
                   class="pagination-btn">
                    –°–ª–µ–¥–≤–∞—â–∞ ‚Üí
                </a>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-bottom">
                <p>&copy; 2024 UFC –ë—ä–ª–≥–∞—Ä–∏—è –§–æ—Ä—É–º - –ê–¥–º–∏–Ω –ü–∞–Ω–µ–ª</p>
            </div>
        </div>
    </footer>
</body>
</html>
