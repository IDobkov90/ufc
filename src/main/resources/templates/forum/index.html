<!DOCTYPE html>
<html lang="bg" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–æ—Ä—É–º - UFC –ë—ä–ª–≥–∞—Ä–∏—è</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a th:href="@{/}" class="logo">
                    <div class="logo-icon">UFC</div>
                    <h1>UFC –ë—ä–ª–≥–∞—Ä–∏—è</h1>
                </a>
                <div class="auth-buttons">
                    <div sec:authorize="!isAuthenticated()">
                        <a th:href="@{/login}" class="btn btn-secondary">–í—Ö–æ–¥</a>
                        <a th:href="@{/user/register}" class="btn btn-primary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                    </div>
                    <div sec:authorize="isAuthenticated()" class="user-info">
                        <span class="user-welcome">–ó–¥—Ä–∞–≤–µ–π, <strong sec:authentication="name">User</strong>!</span>
                        <form th:action="@{/logout}" method="post" style="display: inline;">
                            <button type="submit" class="btn btn-danger">–ò–∑—Ö–æ–¥</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <nav>
        <div class="container">
            <div class="nav-content">
                <ul class="nav-links">
                    <li><a th:href="@{/}">üè† –ù–∞—á–∞–ª–æ</a></li>
                    <li><a th:href="@{/forum}" class="active">üí¨ –§–æ—Ä—É–º</a></li>
                    <li sec:authorize="isAuthenticated()">
                        <a th:href="@{/user/profile/{username}(username=${#authentication.name})}">üë§ –ú–æ—è—Ç –ü—Ä–æ—Ñ–∏–ª</a>
                    </li>
                    <li><a th:href="@{/search}">üîç –¢—ä—Ä—Å–µ–Ω–µ</a></li>
                    <!-- Admin Panel Link - Only visible to ADMIN users -->
                    <li sec:authorize="hasRole('ADMIN')">
                        <a th:href="@{/admin/dashboard}" style="background: linear-gradient(45deg, #d4af37, #ffd700); color: #000; padding: 10px 15px; border-radius: 20px; font-weight: bold;">‚öôÔ∏è –ê–¥–º–∏–Ω</a>
                    </li>
                </ul>

                <!-- Quick Search Form -->
                <div class="nav-search">
                    <form th:action="@{/search}" method="get" class="search-form-inline">
                        <input type="text" name="q" placeholder="–¢—ä—Ä—Å–∏ –≤ —Ñ–æ—Ä—É–º–∞..." class="search-input-inline" required>
                        <button type="submit" class="btn-search-inline">üîç</button>
                    </form>
                </div>
            </div>
        </div>
    </nav>

    <main class="container">
        <div th:if="${successMessage}" class="alert alert-success" role="alert">
            ‚úÖ <span th:text="${successMessage}">Success!</span>
        </div>

        <div th:if="${param.error}" class="alert alert-danger" role="alert">
            ‚ùå –¢–µ–º–∞—Ç–∞ –Ω–µ –±–µ—à–µ –Ω–∞–º–µ—Ä–µ–Ω–∞.
        </div>

        <div class="forum-header">
            <h2>–§–æ—Ä—É–º</h2>
            <div class="forum-actions">
                <a th:href="@{/forum/topic/new}" class="btn btn-primary" sec:authorize="isAuthenticated()">
                    ‚ûï –°—ä–∑–¥–∞–π –Ω–æ–≤–∞ —Ç–µ–º–∞
                </a>
                <div sec:authorize="!isAuthenticated()">
                    <p class="login-prompt">
                        <a th:href="@{/login}">–í–ª–µ–∑—Ç–µ</a> –∑–∞ –¥–∞ —Å—ä–∑–¥–∞–≤–∞—Ç–µ —Ç–µ–º–∏
                    </p>
                </div>
            </div>
        </div>

        <div class="forum-stats">
            <div class="stat-item">
                <span class="stat-value" th:text="${totalTopics}">0</span>
                <span class="stat-label">–¢–µ–º–∏</span>
            </div>
        </div>

        <!-- Category filters -->
        <div class="category-filters">
            <a th:href="@{/forum}" class="category-filter-btn active">–í—Å–∏—á–∫–∏</a>
            <a th:each="cat : ${categories}"
               th:href="@{/forum/category/{category}(category=${cat})}"
               th:text="${cat.displayName}"
               class="category-filter-btn">Category</a>
        </div>

        <!-- Topics list -->
        <div class="topics-list" th:if="${topics != null and !topics.isEmpty()}">
            <div th:each="topic : ${topics.content}" class="topic-item">
                <div class="topic-info">
                    <div class="topic-badges">
                        <span th:if="${topic.isPinned}" class="badge badge-pinned" title="–ó–∞–∫–∞—á–µ–Ω–∞ —Ç–µ–º–∞">üìå</span>
                        <span th:if="${topic.isLocked}" class="badge badge-locked" title="–ó–∞–∫–ª—é—á–µ–Ω–∞ —Ç–µ–º–∞">üîí</span>
                    </div>
                    <h3 class="topic-title">
                        <a th:href="@{/forum/topic/{id}(id=${topic.id})}" th:text="${topic.title}">Topic Title</a>
                    </h3>
                    <div class="topic-meta">
                        <span class="topic-category" th:text="${topic.category.displayName}">Category</span>
                        <span class="topic-author">–æ—Ç <strong th:text="${topic.authorUsername}">Author</strong></span>
                        <span class="topic-date" th:text="${#temporals.format(topic.createdAt, 'dd.MM.yyyy HH:mm')}">Date</span>
                    </div>
                </div>
                <div class="topic-stats">
                    <div class="stat">
                        <span class="stat-icon">üëÅÔ∏è</span>
                        <span th:text="${topic.viewCount}">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-icon">üí¨</span>
                        <span th:text="${topic.replyCount}">0</span>
                    </div>
                </div>
                <div class="topic-last-post" th:if="${topic.lastPostUsername != null}">
                    <div class="last-post-info">
                        <span class="last-post-label">–ü–æ—Å–ª–µ–¥–µ–Ω:</span>
                        <span class="last-post-user" th:text="${topic.lastPostUsername}">User</span>
                        <span class="last-post-date" th:text="${#temporals.format(topic.lastPostAt, 'dd.MM.yyyy HH:mm')}">Date</span>
                    </div>
                </div>
            </div>
        </div>

        <div th:if="${topics == null or topics.isEmpty()}" class="no-topics">
            <p>üì≠ –í—Å–µ –æ—â–µ –Ω—è–º–∞ —Å—ä–∑–¥–∞–¥–µ–Ω–∏ —Ç–µ–º–∏ –≤ —Ç–æ–∑–∏ —Ñ–æ—Ä—É–º.</p>
            <a th:href="@{/forum/topic/new}" class="btn btn-primary" sec:authorize="isAuthenticated()">
                –ë—ä–¥–µ—Ç–µ –ø—ä—Ä–≤–∏—è—Ç, –∫–æ–π—Ç–æ —Å—ä–∑–¥–∞–≤–∞ —Ç–µ–º–∞!
            </a>
        </div>

        <!-- Pagination -->
        <div th:if="${topics != null and topics.totalPages > 1}" class="pagination">
            <a th:if="${topics.hasPrevious()}"
               th:href="@{/forum(page=${topics.number - 1})}"
               class="btn btn-secondary">‚Üê –ü—Ä–µ–¥–∏—à–Ω–∞</a>

            <span class="page-info">
                –°—Ç—Ä–∞–Ω–∏—Ü–∞ <strong th:text="${topics.number + 1}">1</strong> –æ—Ç <strong th:text="${topics.totalPages}">1</strong>
            </span>

            <a th:if="${topics.hasNext()}"
               th:href="@{/forum(page=${topics.number + 1})}"
               class="btn btn-secondary">–°–ª–µ–¥–≤–∞—â–∞ ‚Üí</a>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 UFC –ë—ä–ª–≥–∞—Ä–∏—è. –í—Å–∏—á–∫–∏ –ø—Ä–∞–≤–∞ –∑–∞–ø–∞–∑–µ–Ω–∏.</p>
        </div>
    </footer>
</body>
</html>
