<!DOCTYPE html>
<html lang="bg" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${topic.title} + ' - UFC –ë—ä–ª–≥–∞—Ä–∏—è'">Topic - UFC –ë—ä–ª–≥–∞—Ä–∏—è</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a th:href="@{/}" class="logo">
                    <div class="logo-icon">UFC</div>
                    <h1>UFC –ë—ä–ª–≥–∞—Ä–∏—è</h1>
                </a>
                <div class="auth-buttons">
                    <div sec:authorize="!isAuthenticated()">
                        <a th:href="@{/login}" class="btn btn-secondary">–í—Ö–æ–¥</a>
                        <a th:href="@{/user/register}" class="btn btn-primary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                    </div>
                    <div sec:authorize="isAuthenticated()" class="user-info">
                        <span class="user-welcome">–ó–¥—Ä–∞–≤–µ–π, <strong sec:authentication="name">User</strong>!</span>
                        <form th:action="@{/logout}" method="post" style="display: inline;">
                            <button type="submit" class="btn btn-danger">–ò–∑—Ö–æ–¥</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <nav>
        <div class="container">
            <div class="nav-content">
                <ul class="nav-links">
                    <li><a th:href="@{/}">–ù–∞—á–∞–ª–æ</a></li>
                    <li><a th:href="@{/forum}" class="active">–§–æ—Ä—É–º</a></li>
                    <li><a href="#" title="–ù–æ–≤–∏–Ω–∏ (–°–∫–æ—Ä–æ)">–ù–æ–≤–∏–Ω–∏</a></li>
                    <li><a href="#" title="–ë–æ–µ–≤–µ (–°–∫–æ—Ä–æ)">–ë–æ–µ–≤–µ</a></li>
                    <li><a href="#" title="–ê–Ω–∞–ª–∏–∑–∏ (–°–∫–æ—Ä–æ)">–ê–Ω–∞–ª–∏–∑–∏</a></li>
                    <li><a href="#" title="–ß–ª–µ–Ω–æ–≤–µ (–°–∫–æ—Ä–æ)">–ß–ª–µ–Ω–æ–≤–µ</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container">
        <!-- Success/Error Messages -->
        <div th:if="${successMessage}" class="alert alert-success" role="alert">
            ‚úÖ <span th:text="${successMessage}">Success!</span>
        </div>

        <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
            ‚ùå <span th:text="${errorMessage}">Error!</span>
        </div>

        <div class="breadcrumb">
            <a th:href="@{/forum}">–§–æ—Ä—É–º</a>
            <span class="separator">‚Ä∫</span>
            <a th:href="@{/forum/category/{category}(category=${topic.category})}"
               th:text="${topic.category.displayName}">Category</a>
            <span class="separator">‚Ä∫</span>
            <span th:text="${topic.title}">Topic Title</span>
        </div>

        <div class="topic-header">
            <div class="topic-badges">
                <span th:if="${topic.isPinned}" class="badge badge-pinned" title="–ó–∞–∫–∞—á–µ–Ω–∞ —Ç–µ–º–∞">üìå –ó–∞–∫–∞—á–µ–Ω–∞</span>
                <span th:if="${topic.isLocked}" class="badge badge-locked" title="–ó–∞–∫–ª—é—á–µ–Ω–∞ —Ç–µ–º–∞">üîí –ó–∞–∫–ª—é—á–µ–Ω–∞</span>
                <span class="badge badge-category" th:text="${topic.category.displayName}">Category</span>
            </div>
            <h2 th:text="${topic.title}">Topic Title</h2>
            <div class="topic-stats-inline">
                <span>üëÅÔ∏è <strong th:text="${topic.viewCount}">0</strong> –ø—Ä–µ–≥–ª–µ–¥–∞</span>
                <span>üí¨ <strong th:text="${topic.replyCount}">0</strong> –æ—Ç–≥–æ–≤–æ—Ä–∞</span>
                <span>üìÖ <span th:text="${#temporals.format(topic.createdAt, 'dd.MM.yyyy HH:mm')}">Date</span></span>
            </div>
        </div>

        <!-- Original Topic Post -->
        <div class="topic-content">
            <div class="post original-post">
                <div class="post-author">
                    <div class="author-avatar">
                        <span th:text="${#strings.substring(topic.authorUsername, 0, 1).toUpperCase()}">A</span>
                    </div>
                    <div class="author-info">
                        <a th:href="@{/user/profile/{username}(username=${topic.authorUsername})}" class="author-name username-link" th:text="${topic.authorUsername}">Author</a>
                        <div class="author-role">–ê–≤—Ç–æ—Ä –Ω–∞ —Ç–µ–º–∞—Ç–∞</div>
                        <div class="author-joined">
                            –ß–ª–µ–Ω –æ—Ç: <span th:text="${#temporals.format(topic.createdAt, 'dd.MM.yyyy')}">Date</span>
                        </div>
                    </div>
                </div>
                <div class="post-content">
                    <div class="post-body" th:utext="${#strings.replace(#strings.escapeXml(topic.content), '&#10;', '&lt;br&gt;')}">
                        Content goes here
                    </div>
                    <div class="post-footer">
                        <span class="post-date" th:text="${#temporals.format(topic.createdAt, 'dd.MM.yyyy HH:mm')}">Date</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Posts/Comments Section -->
        <div th:if="${posts != null and !posts.isEmpty()}" class="posts-section">
            <h3 class="posts-heading">–û—Ç–≥–æ–≤–æ—Ä–∏ (<span th:text="${#lists.size(posts)}">0</span>)</h3>

            <div th:each="post, iterStat : ${posts}" class="post">
                <div class="post-author">
                    <div class="author-avatar">
                        <span th:text="${#strings.substring(post.authorUsername, 0, 1).toUpperCase()}">A</span>
                    </div>
                    <div class="author-info">
                        <a th:href="@{/user/profile/{username}(username=${post.authorUsername})}" class="author-name username-link" th:text="${post.authorUsername}">Author</a>
                        <div class="author-role">–ß–ª–µ–Ω</div>
                    </div>
                </div>
                <div class="post-content">
                    <div class="post-body" th:utext="${#strings.replace(#strings.escapeXml(post.content), '&#10;', '&lt;br&gt;')}">
                        Comment content
                    </div>
                    <div class="post-footer">
                        <span class="post-date" th:text="${#temporals.format(post.createdAt, 'dd.MM.yyyy HH:mm')}">Date</span>
                        <span th:if="${post.isEdited}" class="post-edited">(—Ä–µ–¥–∞–∫—Ç–∏—Ä–∞–Ω)</span>

                        <!-- Edit/Delete buttons for post author -->
                        <div sec:authorize="isAuthenticated()" class="post-actions" th:if="${currentUserId != null and (currentUserId == post.authorId or canModifyTopic)}">
                            <a th:href="@{/forum/post/edit/{id}(id=${post.id})}" class="btn-small btn-secondary">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–∞–π</a>
                            <form th:action="@{/forum/post/delete/{id}(id=${post.id})}" method="post" style="display: inline;"
                                  onsubmit="return confirm('–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ —Ç–æ–∑–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä?');">
                                <button type="submit" class="btn-small btn-danger">üóëÔ∏è –ò–∑—Ç—Ä–∏–π</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div th:if="${posts == null or posts.isEmpty()}" class="no-replies">
            <p>üí¨ –í—Å–µ –æ—â–µ –Ω—è–º–∞ –æ—Ç–≥–æ–≤–æ—Ä–∏ –Ω–∞ —Ç–∞–∑–∏ —Ç–µ–º–∞.</p>
            <p sec:authorize="isAuthenticated()">–ë—ä–¥–µ—Ç–µ –ø—ä—Ä–≤–∏—è—Ç, –∫–æ–π—Ç–æ –∫–æ–º–µ–Ω—Ç–∏—Ä–∞!</p>
        </div>

        <!-- Reply Form -->
        <div class="reply-section" sec:authorize="isAuthenticated()">
            <h3>–î–æ–±–∞–≤–∏ –æ—Ç–≥–æ–≤–æ—Ä</h3>

            <div th:if="${topic.isLocked}" class="alert alert-info">
                üîí –¢–µ–º–∞—Ç–∞ –µ –∑–∞–∫–ª—é—á–µ–Ω–∞ –∏ –Ω–µ –º–æ–∂–µ –¥–∞ –ø—Ä–∏–µ–º–∞ –Ω–æ–≤–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä–∏.
            </div>

            <form th:if="${!topic.isLocked}" th:action="@{/forum/post/create}" th:object="${postCreateDto}" method="post" class="reply-form">
                <input type="hidden" name="topicId" th:value="${topic.id}" />

                <div class="form-group">
                    <label for="content">–í–∞—à–∏—è—Ç –∫–æ–º–µ–Ω—Ç–∞—Ä *</label>
                    <textarea id="content"
                              th:field="*{content}"
                              class="form-control"
                              rows="6"
                              placeholder="–ù–∞–ø–∏—à–µ—Ç–µ –≤–∞—à–∏—è –æ—Ç–≥–æ–≤–æ—Ä..."
                              required></textarea>
                    <span class="error-message" th:if="${#fields.hasErrors('content')}" th:errors="*{content}">Content error</span>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">üí¨ –ü—É–±–ª–∏–∫—É–≤–∞–π –æ—Ç–≥–æ–≤–æ—Ä</button>
                    <a th:href="@{/forum}" class="btn btn-secondary">–û—Ç–∫–∞–∑</a>
                </div>
            </form>
        </div>

        <div class="reply-section" sec:authorize="!isAuthenticated()">
            <div class="login-prompt-box">
                <p>–ó–∞ –¥–∞ –æ—Ç–≥–æ–≤–æ—Ä–∏—Ç–µ –Ω–∞ —Ç–∞–∑–∏ —Ç–µ–º–∞, –º–æ–ª—è <a th:href="@{/login}">–≤–ª–µ–∑—Ç–µ –≤ –ø—Ä–æ—Ñ–∏–ª–∞ —Å–∏</a> –∏–ª–∏ <a th:href="@{/user/register}">—Å–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–∞–π—Ç–µ</a>.</p>
            </div>
        </div>

        <div class="topic-navigation">
            <a th:href="@{/forum}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫—ä–º —Ñ–æ—Ä—É–º–∞</a>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 UFC –ë—ä–ª–≥–∞—Ä–∏—è. –í—Å–∏—á–∫–∏ –ø—Ä–∞–≤–∞ –∑–∞–ø–∞–∑–µ–Ω–∏.</p>
        </div>
    </footer>
</body>
</html>
