<!DOCTYPE html>
<html lang="bg" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢—ä—Ä—Å–µ–Ω–µ - UFC –ë—ä–ª–≥–∞—Ä–∏—è</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a th:href="@{/}" class="logo">
                    <div class="logo-icon">UFC</div>
                    <h1>UFC –ë—ä–ª–≥–∞—Ä–∏—è</h1>
                </a>
                <div class="auth-buttons">
                    <div sec:authorize="!isAuthenticated()">
                        <a th:href="@{/login}" class="btn btn-secondary">–í—Ö–æ–¥</a>
                        <a th:href="@{/user/register}" class="btn btn-primary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
                    </div>
                    <div sec:authorize="isAuthenticated()" class="user-info">
                        <span class="user-welcome">–ó–¥—Ä–∞–≤–µ–π, <strong sec:authentication="name">User</strong>!</span>
                        <a th:href="@{/user/profile/{username}(username=${#authentication.name})}" class="btn btn-secondary">üë§ –ü—Ä–æ—Ñ–∏–ª</a>
                        <form th:action="@{/logout}" method="post" style="display: inline;">
                            <button type="submit" class="btn btn-danger">–ò–∑—Ö–æ–¥</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <nav>
        <div class="container">
            <div class="nav-content">
                <ul class="nav-links">
                    <li><a th:href="@{/}">–ù–∞—á–∞–ª–æ</a></li>
                    <li><a th:href="@{/forum}">–§–æ—Ä—É–º</a></li>
                    <li><a th:href="@{/search}" class="active">–¢—ä—Ä—Å–µ–Ω–µ</a></li>
                    <li><a href="#" title="–ù–æ–≤–∏–Ω–∏ (–°–∫–æ—Ä–æ)">–ù–æ–≤–∏–Ω–∏</a></li>
                    <li><a href="#" title="–ë–æ–µ–≤–µ (–°–∫–æ—Ä–æ)">–ë–æ–µ–≤–µ</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container">
        <div class="search-page">
            <h1>üîç –¢—ä—Ä—Å–µ–Ω–µ</h1>

            <!-- Search Form -->
            <div class="search-form-container">
                <form th:action="@{/search}" method="get" class="search-form-large">
                    <div class="search-input-wrapper">
                        <input type="text"
                               name="q"
                               th:value="${query}"
                               placeholder="–¢—ä—Ä—Å–∏ —Ç–µ–º–∏, –∫–æ–º–µ–Ω—Ç–∞—Ä–∏, –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏..."
                               class="search-input-large"
                               autofocus>
                        <button type="submit" class="btn btn-primary search-btn">üîç –¢—ä—Ä—Å–∏</button>
                    </div>

                    <div class="search-filters">
                        <label class="filter-label">–§–∏–ª—Ç—Ä–∏:</label>
                        <label class="radio-label">
                            <input type="radio" name="type" value="all" th:checked="${type == 'all' or type == null}">
                            <span>–í—Å–∏—á–∫–∏</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="type" value="topics" th:checked="${type == 'topics'}">
                            <span>–¢–µ–º–∏</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="type" value="posts" th:checked="${type == 'posts'}">
                            <span>–ö–æ–º–µ–Ω—Ç–∞—Ä–∏</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="type" value="users" th:checked="${type == 'users'}">
                            <span>–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</span>
                        </label>
                    </div>
                </form>
            </div>

            <!-- Empty State -->
            <div th:if="${showEmptyState}" class="empty-state">
                <div class="empty-icon">üîç</div>
                <h2>–ó–∞–ø–æ—á–Ω–µ—Ç–µ —Ç—ä—Ä—Å–µ–Ω–µ</h2>
                <p>–í—ä–≤–µ–¥–µ—Ç–µ –¥—É–º–∞ –∏–ª–∏ —Ñ—Ä–∞–∑–∞ –∑–∞ —Ç—ä—Ä—Å–µ–Ω–µ –Ω–∞ —Ç–µ–º–∏, –∫–æ–º–µ–Ω—Ç–∞—Ä–∏ –∏–ª–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏.</p>
            </div>

            <!-- Search Results -->
            <div th:if="${!showEmptyState and results != null}">
                <!-- Results Summary -->
                <div class="search-summary">
                    <p>
                        –ù–∞–º–µ—Ä–µ–Ω–∏ <strong th:text="${results.totalResults}">0</strong> —Ä–µ–∑—É–ª—Ç–∞—Ç–∞ –∑–∞
                        "<strong th:text="${query}">query</strong>"
                    </p>
                </div>

                <!-- No Results -->
                <div th:if="${results.totalResults == 0}" class="no-results">
                    <div class="empty-icon">üòî</div>
                    <h2>–ù—è–º–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏</h2>
                    <p>–û–ø–∏—Ç–∞–π—Ç–µ —Å –¥—Ä—É–≥–∏ –∫–ª—é—á–æ–≤–∏ –¥—É–º–∏ –∏–ª–∏ –ø—Ä–æ–º–µ–Ω–µ—Ç–µ —Ñ–∏–ª—Ç—Ä–∏—Ç–µ.</p>
                </div>

                <!-- Topics Results -->
                <div th:if="${!results.topics.isEmpty()}" class="search-section">
                    <h2 class="section-title">üìù –¢–µ–º–∏ (<span th:text="${results.topics.size()}">0</span>)</h2>
                    <div class="search-results-list">
                        <div th:each="topic : ${results.topics}" class="search-result-item topic-result">
                            <div class="result-header">
                                <h3 class="result-title">
                                    <a th:href="@{/forum/topic/{id}(id=${topic.id})}" th:text="${topic.title}">Topic Title</a>
                                </h3>
                                <span class="result-category" th:text="${topic.categoryName}">Category</span>
                            </div>
                            <p class="result-excerpt" th:text="${topic.excerpt}">Topic excerpt...</p>
                            <div class="result-meta">
                                <span class="result-author">
                                    üë§ <a th:href="@{/user/profile/{username}(username=${topic.authorUsername})}"
                                         th:text="${topic.authorUsername}">Author</a>
                                </span>
                                <span class="result-date" th:text="${#temporals.format(topic.createdAt, 'dd.MM.yyyy HH:mm')}">Date</span>
                                <span class="result-stat">üëÅÔ∏è <strong th:text="${topic.viewCount}">0</strong></span>
                                <span class="result-stat">üí¨ <strong th:text="${topic.replyCount}">0</strong></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Posts Results -->
                <div th:if="${!results.posts.isEmpty()}" class="search-section">
                    <h2 class="section-title">üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä–∏ (<span th:text="${results.posts.size()}">0</span>)</h2>
                    <div class="search-results-list">
                        <div th:each="post : ${results.posts}" class="search-result-item post-result">
                            <div class="result-header">
                                <h4 class="result-subtitle">
                                    –í —Ç–µ–º–∞: <a th:href="@{/forum/topic/{id}(id=${post.topicId})}"
                                              th:text="${post.topicTitle}">Topic</a>
                                </h4>
                            </div>
                            <p class="result-excerpt" th:text="${post.excerpt}">Post excerpt...</p>
                            <div class="result-meta">
                                <span class="result-author">
                                    üë§ <a th:href="@{/user/profile/{username}(username=${post.authorUsername})}"
                                         th:text="${post.authorUsername}">Author</a>
                                </span>
                                <span class="result-date" th:text="${#temporals.format(post.createdAt, 'dd.MM.yyyy HH:mm')}">Date</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Users Results -->
                <div th:if="${!results.users.isEmpty()}" class="search-section">
                    <h2 class="section-title">üë• –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ (<span th:text="${results.users.size()}">0</span>)</h2>
                    <div class="search-results-list">
                        <div th:each="user : ${results.users}" class="search-result-item user-result">
                            <div class="user-result-content">
                                <div class="user-result-avatar">
                                    <span th:text="${#strings.substring(user.username, 0, 1).toUpperCase()}">U</span>
                                </div>
                                <div class="user-result-info">
                                    <h3 class="result-title">
                                        <a th:href="@{/user/profile/{username}(username=${user.username})}"
                                           th:text="${user.username}">Username</a>
                                    </h3>
                                    <div class="user-result-role" th:text="${user.role}">ROLE</div>
                                    <p th:if="${user.bio != null and !user.bio.isEmpty()}"
                                       class="result-excerpt"
                                       th:text="${user.bio}">User bio</p>
                                    <div class="result-meta">
                                        <span>üìù <strong th:text="${user.topicCount}">0</strong> —Ç–µ–º–∏</span>
                                        <span>üí¨ <strong th:text="${user.postCount}">0</strong> –∫–æ–º–µ–Ω—Ç–∞—Ä–∞</span>
                                        <span class="result-date">
                                            –ß–ª–µ–Ω –æ—Ç: <span th:text="${#temporals.format(user.createdAt, 'dd.MM.yyyy')}">Date</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="back-action">
                <a th:href="@{/forum}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫—ä–º —Ñ–æ—Ä—É–º–∞</a>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 UFC –ë—ä–ª–≥–∞—Ä–∏—è. –í—Å–∏—á–∫–∏ –ø—Ä–∞–≤–∞ –∑–∞–ø–∞–∑–µ–Ω–∏.</p>
        </div>
    </footer>
</body>
</html>

